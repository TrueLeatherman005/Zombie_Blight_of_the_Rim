# Разработка мода Zombie Blight для RimWorld

## 1. Исследование механики Shambler (DLC Anomaly)

*   **Файлы для изучения:** (Указать пути к XML/C# файлам, связанным с шамблерами)
    *   HediffDef: (связанные с состоянием/воскрешением)
    *   ThingDef: `Shambler`
    *   CompProperties: (внутри ThingDef Shambler, связанные с воскрешением, например `CompShambler`?)
    *   JobDef/ThinkTreeDef: (для поведения)
    *   C#: (классы/методы по Shambler, Resurrect, WakeUp, Turn, ShamblerUtility?)
*   **Ключевые механики шамблеров (требуют изучения):**
    *   Механизм воскрешения трупа (условия, триггеры, как блокируется? - возможно, проверка наличия определенных хедиффов/компонентов на трупе).
    *   Атрибуты/способности шамблера.

## 2. Дизайн механик Zombie Blight

*   **Стиль:** Названия и описания должны использовать тему "Скверна" (Blight).
*   **Целевые расы:**
    *   Только "мясные" расы (FleshType != None): Humanlike, Animal, Insectoid.
    *   Исключить: Механоидов, другие специфичные расы.
*   **Фракция "Blight Swarm" (пример):**
    *   Новая FactionDef.
    *   Враждебна ко всем (HostileToAll).
*   **HediffDef "Blight Infection":**
    *   Накладывается атаками зомби, контактом с `Filth_BlightSlime` (низкий шанс?), использованием `Item_BlightSlimePack`.
    *   Стадии: (например: Латентная 0-25%, Инкубация 25-75%, Острая 75-99%, Терминальная 100%)
    *   Эффекты на живую пешку: (незначительные до острой стадии, потом возможно снижение сознания/боль). Получает иммунитет через `Hediff_BlightImmunityGainRate` (стандартный механизм иммунитета).
    *   Эффекты на труп: 
        *   Блокирует стандартное превращение в шамблера (через добавление компонента/состояния?).
        *   Делает труп несъедобным для зомби после достижения ~50% прогресса (или стадии гниения).
    *   Прогрессия:
        *   На живых: (определить базовую скорость), замедляется или останавливается при высоком иммунитете.
        *   На трупах: Скорость выше, чем на живых. Иммунитет игнорируется.
        *   Температурная зависимость на трупах: Прогрессия останавливается при T < minComfortableTemperature и T > maxComfortableTemperature.
        *   Ускоряется при контакте с `Filth_BlightSlime` (если реализовано).
    *   При 100% (Терминальная стадия):
        *   Триггерит добавление `Hediff_BlightZombieState`.
        *   Если на трупе, инициирует воскрешение (Resurrect).
        *   Удаляет себя (`Hediff_BlightInfection`).
    *   Графика: Иконка (создать/выбрать).
*   **HediffDef "Blight Zombie State":**
    *   Добавляется при 100% `Hediff_BlightInfection`.
    *   Является основным маркером состояния "зомби".
    *   **Эффекты:**
        *   Смена фракции на `Blight Swarm` (временно, пока хедифф активен. Исходная фракция должна быть восстановлена при удалении хедиффа - требует C#).
        *   Принудительное использование текстуры гниющего трупа (`BodyTypeDef.Dessicated` или аналогичной) для графики тела (возможно через C#).
        *   Модификация статов: (например, -20% скорость передвижения, +10% урон ближнего боя, -50% скорость поедания).
        *   Добавление способности: Атака ближнего боя (Verb/Tool):
            *   Шанс наложить `Hediff_BlightInfection`.
            *   При успехе: +X% к тяжести `Hediff_BlightInfection`.
        *   Изменение AI (ThinkTree):
            *   Агрессия ко всем не-зомби.
            *   Подавление несовместимых черт (Pacifist).
            *   Фиксированное ментальное состояние (иммунитет к псих. срывам, игнорирование настроения).
            *   Сохранение нужд: Еда, Отдых.
        *   Голод: При нужде "Еда" = 0, добавляется `Hediff_BlightStarvation` (вместо ванильного Malnutrition).
        *   Отдых: Нужда "Отдых" пассивно восстанавливается вне боя. При нужде = 0 *в бою*, пешка входит в неактивное состояние ("спит стоя") до получения урона или восстановления отдыха.
        *   Гибернация: При сильном холоде (ниже `minComfortableTemperature`) блокируется стандартная гипотермия, вместо неё активируется состояние "Blight Hibernation": пешка сильно замедляется, падает без сознания, нужда в еде почти не снижается. Выходит из гибернации при повышении температуры.
        *   Кровь: Заменяет тип крови на `Filth_BlightSlime`.
        *   Авто-лечение: Базовая частота авто-обработки ран = 60 тиков.
    *   **При смерти носителя:** `Hediff_BlightZombieState` удаляется, добавляются `Hediff_BlightCorpseTaint` и `Hediff_PostBlightWeakness`.
*   **HediffDef "Blight Starvation":**
    *   Добавляется при нужде "Еда" = 0 у носителя `Hediff_BlightZombieState`.
    *   Прогрессирует со временем, пока нужда не удовлетворена.
    *   **Эффекты (зависят от тяжести):**
        *   Снижение скорости регенерации.
        *   Снижение шанса заразить цель при атаке и/или добавляемой тяжести.
        *   Увеличение интервала авто-лечения ран (до 1800 тиков при 100%).
    *   Не летален.
*   **HediffDef "BlightCorpseTaint":**
    *   Добавляется на труп при смерти носителя `Hediff_BlightZombieState`.
    *   Позволяет провести операцию по извлечению `Item_BlightSlimePack` (минимум 5 шт.).
    *   Удаляется после успешной операции извлечения.
*   **HediffDef "PostBlightWeakness":**
    *   Добавляется на труп при смерти носителя `Hediff_BlightZombieState`.
    *   **Сохраняется при воскрешении трупа** (любым способом).
    *   Длительность: 3-5 дней.
    *   Эффекты: Временное ослабление (например: -20% Сознание, -20% Скорость передвижения, -50% Скорость набора иммунитета).
*   **FilthDef "Filth_BlightSlime":**
    *   Цвет: Черный/темно-зеленый.
    *   Источник: Носители `Hediff_BlightZombieState`.
    *   **Эффекты:**
        *   При контакте (стоянии/ходьбе): *Идея на будущее:* Шанс наложить `Hediff_BlightInfection` (зависит от времени контакта, иммунитета пешки, целостности кожи?).
        *   Сбор: Шанс (30%) собрать `Item_BlightSlimePack`.
*   **ThingDef "Item_BlightSlimePack":**
    *   Добывается:
        *   Операцией с трупа зомби (требует `Hediff_BlightCorpseTaint`).
        *   Сбором с `Filth_BlightSlime` (шанс 30%).
    *   Стакается.
    *   Используется для крафта `Item_BlightCells`.
*   **ThingDef "Item_BlightCells":**
    *   Добывается: Крафт из `Item_BlightSlimePack` (рецепт на костре/плите/хим.столе).
    *   Используется для крафта:
        *   Сывороток лечения (`BlightCleanseSerum_...`).
        *   Пищевой добавки (`Item_BlightResistantAdditive`).
*   **ThingDef "Item_BlightResistantAdditive":**
    *   Кол-во: 45 ед. Питательность: 0.1/ед. (Итого 4.5).
    *   Добывается: Крафт из `Item_BlightCells` + 8 ед. пит сырья (на костре/плите/хим.столе?).
    *   Тип: Ингредиент (не мясо/не растительный).
    *   **Использование:**
        *   Добавляется в блюда при готовке.
        *   Добавляется в готовые блюда (отдельный рецепт).
        *   Можно съесть напрямую.
    *   **Эффект:** При употреблении дает `Hediff_BlightResistance` на 12 часов.
*   **Рецепты Сывороток (на хим. столе, если не указано иное):**
    *   `Recipe_Make_BlightCleanseSerum_Herbal`: 1x `Item_BlightCells` + 5x Herbal Medicine -> `BlightCleanseSerum_Herbal` (Можно и на костре/плите).
    *   `Recipe_Make_BlightCleanseSerum_Industrial`: 1x `Item_BlightCells` + 1x Industrial Medicine -> `BlightCleanseSerum_Industrial`.
    *   `Recipe_Make_BlightCleanseSerum_Glitter`: 2x `Item_BlightCells` + 1x Glitterworld Medicine -> `BlightCleanseSerum_Glitter`.
*   **ThingDef Сывороток:**
    *   `BlightCleanseSerum_Herbal`: При использовании добавляет +10% к текущему иммунитету от `Hediff_BlightInfection` (максимальный иммунитет от этой сыворотки - 50%).
    *   `BlightCleanseSerum_Industrial`: При использовании добавляет +30% к текущему иммунитету от `Hediff_BlightInfection` (максимальный иммунитет от этой сыворотки - 90%).
    *   `BlightCleanseSerum_Glitter`: При использовании: Устанавливает иммунитет `Hediff_BlightInfection` на 100%, уменьшает тяжесть на 50%, даёт `Hediff_BlightImmunity` на 36 часов.
*   **HediffDef "BlightResistance":**
    *   Длительность: 12 часов.
    *   Эффекты: Значительно снижает шанс получения `Hediff_BlightInfection`, сильно замедляет его прогрессию (если уже есть). Не дает полного иммунитета.
*   **HediffDef "BlightImmunity":**
    *   Длительность: 36 часов.
    *   Эффекты: Полный иммунитет к `Hediff_BlightInfection`.
*   **ThingDef "Shell_BlightGas" / "Mine_BlightGas" / "Grenade_BlightGas":**
    *   Крафтятся `Item_BlightSlimePack` + стандартныекомпоненты для аналогичных предметов.
    *   Механика: При взрыве/срабатывании создают облако газа (`Gas_Blight`).
    *   `Gas_Blight`: Накладывает `Hediff_BlightInfection` на пешек в области.

## 3. Технические аспекты

*   **Структура мода:**
    *   Defs (XML): HediffDefs, ThingDefs (Filth, Item, Gas, Projectile, RaceMutation?), FactionDef, RecipeDefs, JobDefs/ThinkTreeDefs (для AI зомби), VerbDefs/ToolDefs (для атаки).
    *   Textures: Иконки хедиффов, предметов, возможно, текстура слизи.
    *   Assemblies (C#): Потребуется для:
        *   Логики прогрессии хедиффа (температура, иммунитет, блокировка шамблеров).
        *   Механики голода/отдыха/гибернации зомби.
        *   Динамической смены текстуры тела.
        *   Кастомного поведения AI (включая "засыпание").
        *   Эффектов газа/слизи (включая сбор пакетов).
        *   Само-воскрешения.
        *   Добавления тяжести инфекции при атаке.
    *   Patches: Для интеграции (например, добавление рецептов, операций, модификация атак).
*   **Потенциальные сложности:**
    *   Реализация C# компонентов (особенно смена графики, AI, гибернация).
    *   Баланс (скорость заражения, сила зомби, экономика ресурсов, эффективность лекарств).
    *   Совместимость с модами, меняющими расы, AI, механики трупов, медицину.
    *   Оптимизация (большое количество зомби/слизи).
    *   Точная реализация блокировки воскрешения шамблеров.
    *   Механика "засыпания" в бою.

## 4. Заметки и идеи

*   **Поведение зомби (AI):**
    *   Склонность к групповой охоте.
    *   В основном ищут еду, но могут пытаться проламывать стены (особенно во время рейдов).
    *   Случайные появления/уходы с карты.
    *   Специальные рейды/события с целенаправленной атакой.
    *   Активность на карте может зависеть от графика (по аналогии с Zombieland).
*   **Эволюция зомби (Возможная фича):**
    *   Прогресс `Hediff_BlightZombieState` (зависящий от времени, питания, заражений, окружения) приводит к повышению "уровня" зомби (через замену хедиффа на более мощную версию).
    *   Уровень 1: Базовый зомби.
    *   Уровень 2: Может использовать оружие ближнего боя.
    *   Уровень 3-4: Может использовать стрелковое оружие (точность зависит от исходных навыков пешки).
    *   Уровень 5+: Появление специализаций (Танк, Плюющий, Таранный, Метатель (бросает меньших зомби) и т.д.). Уровень 5 - не предел.
    *   Базовые навыки и черты исходной пешки продолжают влиять на способности зомби.
*   **Заражение от слизи (Filth):** Можно реализовать позже с настройкой шанса (зависит от времени в слизи, иммунитета, состояния кожи/одежды).

(Место для дальнейших заметок)
